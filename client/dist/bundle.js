webpackJsonp([0],[function(a,b,c){"use strict";function d(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}}function e(a){return a instanceof s||Object.getPrototypeOf(a)instanceof s}function f(a){return e(a)?a.message:(console.log(a),"N\xE3o foi poss\xEDvel realizar a opera\xE7\xE3o.")}function g(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}}function h(a=500){return function(b,c,d){const e=d.value;let f=0;return d.value=function(...b){event&&event.preventDefault(),clearInterval(f),f=setTimeout(()=>e.apply(this,b),a)},d}}function i(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}}function j(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}Object.defineProperty(b,"__esModule",{value:!0});let k=class{constructor(a,b,c){Object.assign(this,{_quantidade:b,_valor:c}),this._data=new Date(a.getTime()),Object.freeze(this)}get volume(){return this._quantidade*this._valor}get data(){return new Date(this._data.getTime())}get quantidade(){return this._quantidade}get valor(){return this._valor}equals(a){return JSON.stringify(this)==JSON.stringify(a)}},l=class{constructor(a){this._connection=a,this._store="negociacoes"}adiciona(a){return new Promise((b,c)=>{const d=this._connection.transaction([this._store],"readwrite").objectStore(this._store).add(a);d.onsuccess=()=>b(),d.onerror=(a)=>{console.log(a.target.error),c("N\xE3o foi poss\xEDvel salvar a negocia\xE7\xE3o")}})}listaTodos(){return new Promise((a,b)=>{const c=[],d=this._connection.transaction([this._store],"readwrite").objectStore(this._store).openCursor();d.onsuccess=(b)=>{const d=b.target.result;if(d){const a=new k(d.value._data,d.value._quantidade,d.value._valor);c.push(a),d.continue()}else a(c)},d.onerror=(a)=>{console.log(a.target.error),b("N\xE3o foi poss\xEDvel listar as negociacoes")}})}apagaTodos(){return new Promise((a,b)=>{const c=this._connection.transaction([this._store],"readwrite").objectStore(this._store).clear();c.onsuccess=()=>a(),c.onerror=(a)=>{console.log(a.target.error),b("N\xE3o foi poss\xEDvel apagar as negocia\xE7\xF5es")}})}},m=class{get(a){return new Promise((b,c)=>{const d=new XMLHttpRequest;d.open("GET",a),d.onreadystatechange=()=>{4==d.readyState&&(200==d.status?b(JSON.parse(d.responseText)):(console.log(d.responseText),c(d.responseText)))},d.send()})}},n=class{constructor(){this._http=new m}obterNegociacoesDaSemana(){return this._http.get("http://localhost:3000/negociacoes/semana").then((a)=>a.map((a)=>new k(new Date(a.data),a.quantidade,a.valor)),()=>{throw new ApplicationException("N\xE3o foi poss\xEDvel obter as negocia\xE7\xF5es")})}obtemNegociacoesDaSemanaAnterior(){return this._http.get("http://localhost:3000/negociacoes/anterior").then((a)=>a.map((a)=>new k(new Date(a.data),a.quantidade,a.valor)),()=>{throw new ApplicationException("N\xE3o foi poss\xEDvel obter as negocia\xE7\xF5es da semana anterior")})}obtemNegociacoesDaSemanaRetrasada(){return this._http.get("http://localhost:3000/negociacoes/retrasada").then((a)=>a.map((a)=>new k(new Date(a.data),a.quantidade,a.valor)),()=>{throw new ApplicationException("N\xE3o foi poss\xEDvel obter as negocia\xE7\xF5es da semana retrasada")})}obtemNegociacoesDoPeriodo(){var a=this;return d(function*(){try{let b=yield Promise.all([a.obterNegociacoesDaSemana(),a.obtemNegociacoesDaSemanaAnterior(),a.obtemNegociacoesDaSemanaRetrasada()]);return b.reduce(function(a,b){return a.concat(b)},[]).sort(function(c,a){return c.data.getTime()-a.data.getTime()})}catch(a){throw console.log(a),new ApplicationException("N\xE3o foi poss\xEDvel obter as negocia\xE7\xF5es do per\xEDdo")}})()}},o=class{constructor(){this._negociacoes=[],Object.freeze(this)}adiciona(a){this._negociacoes.push(a)}paraArray(){return[].concat(this._negociacoes)}get volumeTotal(){return 0<this._negociacoes.length?this._negociacoes.reduce((a,b)=>a+b.volume,0):0}esvazia(){this._negociacoes.length=0}},p=class{constructor(a){this._elemento=document.querySelector(a)}update(a){this._elemento.innerHTML=this.template(a)}template(){throw new Error("Voc\xEA precisa implementar o m\xE9todo template!")}},q=class extends p{template(a){return a.texto?`<p class="alert alert-info">${a.texto}</p>`:`<p></p>`}},r=class extends Error{constructor(a=""){super(a),this.name=this.constructor.name}};const s=r;let t=class extends r{constructor(){super("A data deve estar no formato dd/mm/aaaa")}},u=class{constructor(){throw new Error("Esta classe n\xE3o pode ser instanciada")}static paraTexto(a){return`${a.getDate()}/${a.getMonth()+1}/${a.getFullYear()}`}static paraData(a){if(!/\d{2}\/\d{2}\/\d{4}/.test(a))throw new t;return new Date(...a.split("/").reverse().map((a,b)=>a-b%2))}},v=class extends p{template(a){let b=a.paraArray().map((a)=>`<tr>
                                <td>${u.paraTexto(a.data)}</td>
                                <td>${a.quantidade}</td>
                                <td>${a.valor}</td>
                                <td>${a.volume}</td>
                            </tr>`).join("");return`    
                <table class="table table-hover table-bordered">
                <thead>
                    <tr>
                        <th>DATA</th>
                        <th>QUANTIDADE</th>
                        <th>VALOR</th>
                        <th>VOLUME</th>
                    </tr>
                </thead>
                
                <tbody>
                    ${b}
                    <tr>
                        <td colspan="3"></td>
                        <td>${a.volumeTotal}</td>
                    </tr>
                </tbody>
                
                <tfoot>
                </tfoot>
            </table>`}},w=class{constructor(a=""){this._texto=a}get texto(){return this._texto}set texto(a){this._texto=a}},x=class a{static create(b,c,d){return new Proxy(b,{get(b,e){return a.ehFuncao(b[e])&&c.includes(e)?function(){b[e].apply(b,arguments),d(b)}:b[e]},set(a,b,e){const f=Reflect.set(a,b,e);return c.includes(b)&&d(a),f}})}static ehFuncao(a){return typeof a==typeof Function}},y=class{constructor(a,b,...c){const d=x.create(a,c,(a)=>{b.update(a)});return b.update(a),d}};const z=["negociacoes"];let A=null,B=null,C=class a{constructor(){throw new Error("N\xE3o \xE9 permitido instanciar pelo construtor")}static getConnection(){return new Promise((b,c)=>{if(A)return b(A);const d=indexedDB.open("jscangaceiro",2);d.onupgradeneeded=(b)=>{a._createStores(b.target.result)},d.onsuccess=(a)=>{A=a.target.result,B=A.close.bind(A),A.close=()=>{throw new Error("Voc\xEA n\xE3o pode fechar diretamente a conex\xE3o")},b(a.target.result)},d.onerror=(a)=>{console.log(a.target.error),c(a.target.error.name)}})}static _createStores(a){z.forEach((b)=>{a.objectStoreNames.contains(b)&&a.deleteObjectStore(b),a.createObjectStore(b,{autoIncrement:!0})})}static closeConnection(){A&&B()}},D=(()=>{var a=g(function*(){let a=yield C.getConnection();return new l(a)});return function(){return a.apply(this,arguments)}})();var E,F,G,H,I;let J=(E=function(...a){const b=a.map((a)=>document.querySelector(a));return function(a){const c=a,d=function(){return new c(...b)};return d.prototype=c.prototype,d}}("#data","#quantidade","#valor"),F=h(),G=h(),E(H=(I=class{constructor(a,b,c){Object.assign(this,{_inputData:a,_inputQuantidade:b,_inputValor:c});this;this._negociacoes=new y(new o(),new v("#negociacoes"),"adiciona","esvazia"),this._mensagem=new y(new w(),new q("#mensagemView"),"texto"),this._service=new n,this._init()}_init(){var a=this;return i(function*(){try{const b=yield D(),c=yield b.listaTodos();c.forEach(function(b){return a._negociacoes.adiciona(b)})}catch(b){a._mensagem.texto=f(b)}})()}importaNegociacoes(){var a=this;return i(function*(){try{const b=yield a._service.obtemNegociacoesDoPeriodo();b.filter(function(b){return!a._negociacoes.paraArray().some(function(a){return b.equals(a)})}).forEach(function(b){return a._negociacoes.adiciona(b)}),a._mensagem.texto="Negocia\xE7\xF5es do per\xEDodo importadas com sucesso"}catch(b){a._mensagem.texto=f(b)}})()}adiciona(a){var b=this;return i(function*(){try{a.preventDefault();const c=b._criaNegociacao(),d=yield D();yield d.adiciona(c),b._negociacoes.adiciona(c),b._mensagem.texto="Negocia\xE7\xE3o adicionada com sucesso",b._limpaFormulario()}catch(a){b._mensagem.texto=f(a)}})()}apaga(){var a=this;return i(function*(){try{const b=yield D();yield b.apagaTodos(),a._negociacoes.esvazia(),a._mensagem.texto="Negocia\xE7\xF5es apagadas com sucesso"}catch(b){a._mensagem.texto=f(b)}})()}_limpaFormulario(){this._inputData.value="",this._inputQuantidade.value=1,this._inputValor.value=0,this._inputData.focus()}_criaNegociacao(){return new k(u.paraData(this._inputData.value),parseInt(this._inputQuantidade.value),parseFloat(this._inputValor.value))}},j(I.prototype,"importaNegociacoes",[F],Object.getOwnPropertyDescriptor(I.prototype,"importaNegociacoes"),I.prototype),j(I.prototype,"adiciona",[G],Object.getOwnPropertyDescriptor(I.prototype,"adiciona"),I.prototype),I))||H);var K=c(1),L=c.n(K),M=c(2),N=c.n(M),O=c(3),P=c.n(O);const Q=new J,R=document.querySelector.bind(document);R(".form").addEventListener("submit",Q.adiciona.bind(Q)),R("#botao-apaga").addEventListener("click",Q.apaga.bind(Q)),R("#botao-importa").addEventListener("click",Q.importaNegociacoes.bind(Q))},function(){},function(){},function(){}],[0]);